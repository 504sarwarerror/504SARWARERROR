<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BARTMOSS - C64 Terminal</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: #000;
      font-family: 'Press Start 2P', monospace;
      overflow: hidden;
      width: 100vw;
      height: 100vh;
    }

    .c64-screen {
      background: #3939C4;
      width: 100vw;
      height: 100vh;
      color: #7C71DA;
      padding: 40px 60px;
      font-size: 13px;
      text-transform: uppercase;
      position: relative;
      overflow-y: auto;
    }

    .scanline {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to bottom,
          transparent 50%,
          rgba(0, 0, 0, 0.15) 50%);
      background-size: 100% 3px;
      pointer-events: none;
      z-index: 1000;
      animation: scanlineMove 8s linear infinite;
    }

    @keyframes scanlineMove {
      0% {
        transform: translateY(0);
      }

      100% {
        transform: translateY(3px);
      }
    }

    .crt-effect {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: radial-gradient(ellipse at center, transparent 0%, rgba(0, 0, 0, 0.3) 100%);
      pointer-events: none;
      z-index: 999;
    }

    .flicker {
      animation: flicker 0.15s infinite;
    }

    @keyframes flicker {

      0%,
      100% {
        opacity: 1;
      }

      50% {
        opacity: 0.95;
      }
    }

    .terminal-line {
      margin: 5px 0;
      line-height: 1.4;
      opacity: 0;
      animation: fadeIn 0.3s forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
      }
    }

    .cursor {
      display: inline-block;
      width: 12px;
      height: 18px;
      background: #7C71DA;
      animation: blink 0.8s infinite;
      vertical-align: text-bottom;
      margin-left: 2px;
    }

    @keyframes blink {

      0%,
      50% {
        opacity: 1;
      }

      51%,
      100% {
        opacity: 0;
      }
    }

    .header {
      margin-bottom: 25px;
    }

    .menu-item {
      cursor: pointer;
      padding: 3px 0;
      transition: all 0.1s;
      position: relative;
    }

    .menu-item:hover {
      color: #FFFFFF;
      text-shadow: 0 0 8px #FFFFFF;
    }

    .menu-item:hover::before {
      content: '>';
      position: absolute;
      left: -20px;
      animation: arrowBounce 0.5s infinite;
    }

    @keyframes arrowBounce {

      0%,
      100% {
        transform: translateX(0);
      }

      50% {
        transform: translateX(5px);
      }
    }

    .loading-bar {
      display: inline-block;
    }

    .loading-char {
      display: inline-block;
      animation: load 0.3s ease-in-out;
    }

    @keyframes load {
      0% {
        opacity: 0;
        transform: scale(0);
      }

      100% {
        opacity: 1;
        transform: scale(1);
      }
    }

    .popup-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #000;
      z-index: 2000;
      align-items: center;
      justify-content: center;
    }

    .popup-overlay.active {
      display: flex;
      animation: fadeIn 0.2s;
    }

    .popup-window {
      background: #3939C4;
      width: 100%;
      height: 100%;
      overflow-y: auto;
      padding: 40px 60px;
      color: #7C71DA;
      font-size: 13px;
      position: relative;
    }

    .popup-header {
      border-bottom: 1px solid #7C71DA;
      padding-bottom: 15px;
      margin-bottom: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      z-index: 1001;
    }

    .close-btn {
      cursor: pointer;
      padding: 8px 20px;
      background: transparent;
      border: 2px solid #7C71DA;
      color: #7C71DA;
      font-family: 'Press Start 2P', monospace;
      font-size: 11px;
      transition: all 0.2s;
    }

    .close-btn:hover {
      color: #FFFFFF;
      border-color: #FFFFFF;
      background: rgba(255, 255, 255, 0.1);
    }

    .popup-content {
      line-height: 1.6;
      position: relative;
      z-index: 1001;
      color: #7C71DA;
    }

    .item-box {
      border: 1px solid #7C71DA;
      padding: 15px;
      margin: 15px 0;
      cursor: pointer;
      background: transparent;
      color: #7C71DA;
      transition: all 0.2s;
    }

    .item-box:hover {
      border-color: #FFFFFF;
      color: #FFFFFF;
      background: rgba(0, 0, 20);
    }

    .item-title {
      margin-bottom: 8px;
      font-size: 11px;
    }

    .item-desc {
      font-size: 9px;
      line-height: 1.5;
      color: #9B93E0;
    }

    .link-box {
      border: 1px solid #7C71DA;
      padding: 12px;
      margin: 10px 0;
      cursor: pointer;
      background: transparent;
      color: #7C71DA;
      transition: all 0.2s;
    }

    .link-box:hover {
      background: rgba(0, 0, 20, 0.3);
      color: #FFFFFF;
      border-color: #FFFFFF;
    }

    .highlight {
      color: #FFFFFF;
    }

    .typewriter {
      overflow: hidden;
      white-space: nowrap;
      border-right: 2px solid #7C71DA;
      animation: typing 2s steps(40) 1s forwards, blink-border 0.75s step-end infinite;
    }

    @keyframes typing {
      from {
        width: 0;
      }

      to {
        width: 100%;
      }
    }

    @keyframes blink-border {
      50% {
        border-color: transparent;
      }
    }

    .shake {
      animation: shake 0.5s;
    }

    @keyframes shake {

      0%,
      100% {
        transform: translateX(0);
      }

      10%,
      30%,
      50%,
      70%,
      90% {
        transform: translateX(-5px);
      }

      20%,
      40%,
      60%,
      80% {
        transform: translateX(5px);
      }
    }

    .power-on-flash {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #A5A5FF;
      z-index: 10000;
      animation: powerOn 0.8s ease-out forwards;
      pointer-events: none;
    }

    @keyframes powerOn {
      0% {
        opacity: 1;
      }
      50% {
        opacity: 1;
      }
      100% {
        opacity: 0;
        visibility: hidden;
      }
    }

    .disk-activity {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 15px;
      height: 15px;
      background: #FF0000;
      border-radius: 50%;
      opacity: 0;
      z-index: 1002;
      box-shadow: 0 0 10px #FF0000;
    }

    .disk-activity.active {
      animation: diskBlink 0.3s ease-in-out infinite;
    }

    @keyframes diskBlink {
      0%, 100% {
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
    }

    .command-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(0, 0, 0, 0.8);
      padding: 10px 20px;
      font-size: 11px;
      color: #7C71DA;
      border-top: 1px solid #7C71DA;
      z-index: 1003;
      display: none;
    }

    .command-bar.active {
      display: none;
    }

    .command-input {
      background: transparent;
      border: none;
      color: #7C71DA;
      font-family: 'Press Start 2P', monospace;
      font-size: 13px;
      outline: none;
      width: auto;
      min-width: 20px;
      text-transform: uppercase;
      display: inline-block;
      caret-color: transparent;
    }

    .command-line {
      display: none;
    }

    .command-line.active {
      display: inline;
    }

    .easter-egg {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: #3939C4;
      border: 2px solid #7C71DA;
      padding: 30px;
      z-index: 9999;
      text-align: center;
      animation: fadeIn 0.5s;
    }

    .easter-egg.show {
      display: block;
    }

    .credits {
      position: fixed;
      top: 10px;
      right: 10px;
      font-size: 8px;
      color: #7C71DA;
      opacity: 0.6;
      z-index: 1001;
      text-align: right;
    }

    .border-flash {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      border: 10px solid #7C71DA;
      pointer-events: none;
      z-index: 1004;
      opacity: 0;
    }

    .border-flash.active {
      animation: borderPulse 0.5s ease-out;
    }

    @keyframes borderPulse {
      0%, 100% {
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
    }

    @media (max-width: 768px) {
      .c64-screen {
        padding: 20px 30px;
        font-size: 10px;
      }

      .popup-window {
        padding: 20px 30px;
        font-size: 10px;
      }

      .close-btn {
        padding: 6px 15px;
        font-size: 9px;
      }
    }
  </style>
</head>

<body>
  <!-- Power-on flash effect -->
  <div class="power-on-flash"></div>
  
  <!-- Disk drive activity LED -->
  <div class="disk-activity" id="diskLED"></div>

  <!-- Border flash effect -->
  <div class="border-flash" id="borderFlash"></div>

  <!-- Credits -->
  <div class="credits">
    (C) 2025 BARTMOSS<br>
  </div>

  <!-- Easter egg -->
  <div class="easter-egg" id="easterEgg">
    <div class="terminal-line">★ SECRET DISCOVERED ★</div>
    <div class="terminal-line"></div>
    <div class="terminal-line">KONAMI CODE ACTIVATED</div>
    <div class="terminal-line"></div>
    <div class="terminal-line">YOU FOUND THE HIDDEN</div>
    <div class="terminal-line">CYBER EASTER EGG!</div>
    <div class="terminal-line"></div>
    <div class="terminal-line" style="font-size: 8px;">PRESS ESC TO CLOSE</div>
  </div>

  <!-- Command bar -->
  <div class="command-bar" id="commandBar">
    <span>> </span><input type="text" class="command-input" id="commandInput" placeholder="TYPE COMMAND..." />
  </div>

  <div class="c64-screen flicker">
    <div class="scanline"></div>
    <div class="crt-effect"></div>

    <div id="bootSequence"></div>
  </div>

  <!-- About Popup -->
  <div class="popup-overlay" id="popup-about">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"ABOUT.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('about')">X</button>
      </div>
      <div class="popup-content" id="aboutContent"></div>
    </div>
  </div>

  <!-- Projects Popup -->
  <div class="popup-overlay" id="popup-projects">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"PROJECTS.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('projects')">X</button>
      </div>
      <div class="popup-content" id="projectsContent"></div>
    </div>
  </div>

  <!-- Writeups Popup -->
  <div class="popup-overlay" id="popup-writeups">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"WRITEUPS.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('writeups')">X</button>
      </div>
      <div class="popup-content" id="writeupsContent"></div>
    </div>
  </div>

  <!-- Links Popup -->
  <div class="popup-overlay" id="popup-links">
    <div class="popup-window flicker">
      <div class="scanline"></div>
      <div class="crt-effect"></div>
      <div class="popup-header">
        <div>LOAD"LINKS.PRG",8,1</div>
        <button class="close-btn" onclick="closePopup('links')">X</button>
      </div>
      <div class="popup-content" id="linksContent"></div>
    </div>
  </div>

  <script>
    const projects = [
      {
        title: '[01] CASM COMPILER',
        desc: 'A COMPILER DESIGNED TO SEAMLESSLY BLEND THE POWER AND CONTROL OF ASSEMBLY WITH THE SIMPLICITY AND READABILITY OF C-LIKE HIGH-LEVEL CONSTRUCTS. CONTEMPORARY HIGH-LEVEL FRONT-END FOR NASM (WINDOWS X64 FOCUSED).',
        url: 'https://github.com/504sarwarerror/casm'
      },
      {
        title: '[02] RABIDS FRAMEWORK',
        desc: 'ROVING AUTONOMOUS BARTMOSS INTERFACE DRONES - COMPREHENSIVE FRAMEWORK FOR BUILDING CUSTOM OFFENSIVE SECURITY PAYLOADS. POWERFUL YET INTUITIVE GRAPHICAL INTERFACE TO CHAIN TOGETHER VARIOUS MODULES.',
        url: 'https://github.com/504sarwarerror/rabids'
      },
      {
        title: '[03] SAVANT RAG SYSTEM',
        desc: 'RETRIEVAL-AUGMENTED GENERATION SYSTEM FOR MALWARE CODE GENERATION, POWERED BY 50,000 MALWARE SAMPLES INCLUDING STEALERS, WORMS, KEYLOGGERS. DESIGNED FOR SECURITY RESEARCHERS AND RED-TEAMERS.',
        url: 'https://github.com/504sarwarerror/SAVANT'
      },
      {
        title: '[04] BLACKWALL DATABASE',
        desc: 'CENTRALIZED RESOURCE FOR LOCATING VIRUS SAMPLES. INTENDED FOR IN-DEPTH ANALYSIS, RESEARCH, REVERSE ENGINEERING, OR EDUCATIONAL REVIEW. COMPREHENSIVE LIVING REPOSITORY.',
        url: 'https://github.com/504sarwarerror/blackwall'
      }
    ];

    const writeups = [
      {
        title: '[01] ATM JACKPOTTING',
        desc: 'SPITTING OUT BILLS - ATM JACKPOTTING SOUNDS LIKE SOMETHING OUT OF A MOVIE, BUT IT\'S A REAL ATTACK HAPPENING AROUND THE WORLD. SECRET CHEAT CODE FOR INFINITE MONEY MODE.',
        url: 'https://github.com/504sarwarerror/504SARWARERROR/wiki/ATM-Jackpotting-Spitting-Out-Bills'
      },
      {
        title: '[02] MALWARE INTERNALS',
        desc: 'BASICS OF MALWARE INTERNAL STRUCTURE - IMAGINE YOUR COMPUTER HOLDING YOUR FILES HOSTAGE, LOCKED AWAY BEHIND AN UNBREAKABLE DIGITAL VAULT WITH A MENACING NOTE DEMANDING PAYMENT.',
        url: 'https://github.com/504sarwarerror/504SARWARERROR/wiki/Basic\'s-of-Malware-Internal-Structure'
      },
      {
        title: '[03] DISCORD C2 SERVER',
        desc: 'C2 SERVERS ARE LIKE PUPPET MASTERS CONTROLLING ALL THE PUPPETS UNDER THEM. JUST AS A PUPPET MASTER PULLS THE STRINGS TO MAKE PUPPETS MOVE, A C2 SERVER SENDS INSTRUCTIONS.',
        url: 'https://github.com/504sarwarerror/504SARWARERROR/wiki/Discord-C2-Server-and-a-Rat'
      },
      {
        title: '[04] USERLAND ROOTKITS',
        desc: 'THE GHOST IN THE MACHINE - YOUR COMPUTER SEEMS FINE BUT SOMETHING INVISIBLE IS HIDING DEEP INSIDE YOUR SYSTEM. WATCHING. WAITING. IT CAN SPY ON YOU, STEAL YOUR DATA.',
        url: 'https://github.com/504sarwarerror/504SARWARERROR/wiki/Userland-Rootkit\'s-and-the-Code-Behind-it'
      }
    ];

    const links = [
      { title: '> TWITTER/X', desc: '@SARWAROFFLINE', url: 'https://x.com/sarwaroffline' },
      { title: '> GITHUB', desc: 'GITHUB.COM/504SARWARERROR', url: 'https://github.com/504sarwarerror' },
      { title: '> DISCORD', desc: 'DISCORD.GG/CTRLALTDELETE', url: 'https://discord.gg/aWeFF8cfAn' },
      { title: '> WIKI', desc: 'TECHNICAL WRITEUPS & RESEARCH', url: 'https://github.com/504sarwarerror/504SARWARERROR/wiki' }
    ];

    // Disk drive activity simulator
    function showDiskActivity(duration = 1000) {
      const led = document.getElementById('diskLED');
      led.classList.add('active');
      setTimeout(() => {
        led.classList.remove('active');
      }, duration);
    }

    function typeWriter(element, text, speed = 30, callback) {
      let i = 0;
      element.innerHTML = '';

      function type() {
        if (i < text.length) {
          element.innerHTML += text.charAt(i);
          i++;
          setTimeout(type, speed);
        } else if (callback) {
          callback();
        }
      }
      type();
    }

    function addLine(parent, text, delay = 0) {
      return new Promise(resolve => {
        setTimeout(() => {
          const line = document.createElement('div');
          line.className = 'terminal-line';
          line.textContent = text;
          parent.appendChild(line);
          resolve();
        }, delay);
      });
    }

    async function bootSequence() {
      const container = document.getElementById('bootSequence');

      // Show disk activity during boot
      showDiskActivity(800);

      await addLine(container, '    **** COMMODORE 64 BASIC V2 ****', 100);
      await addLine(container, '', 50);
      await addLine(container, ' 64K RAM SYSTEM 38911 BASIC BYTES FREE', 100);
      await addLine(container, '', 100);
      await addLine(container, 'READY.', 200);
      await addLine(container, 'LOAD"BARTMOSS.SYS",8', 300);
      await addLine(container, '', 100);
      
      // Disk activity during search
      showDiskActivity(2000);
      await addLine(container, 'SEARCHING FOR BARTMOSS.SYS', 200);

      const loadingLine = document.createElement('div');
      loadingLine.className = 'terminal-line';
      container.appendChild(loadingLine);

      await new Promise(resolve => {
        let dots = '';
        let count = 0;
        const interval = setInterval(() => {
          dots += '.';
          loadingLine.textContent = 'LOADING' + dots;
          count++;
          if (count >= 20) {
            clearInterval(interval);
            resolve();
          }
        }, 80);
      });

      await addLine(container, 'READY.', 200);
      await addLine(container, 'RUN', 300);
      await addLine(container, '', 100);
      
      // Add classic C64 border characters
      await addLine(container, 'SARWAR "BARTMOSS" TERMINAL', 100);
      await addLine(container, '', 100);
      await addLine(container, 'SYS 64738', 150);
      await addLine(container, '> SYSTEM INITIALIZED', 150);
      await addLine(container, '', 200);
      await addLine(container, '0 "SYSTEM     " 00 2A', 200);
      await addLine(container, '', 100);

      const menu = document.createElement('div');
      menu.innerHTML = `
        <div class="terminal-line menu-item" onclick="loadProgram('about')">10 "ABOUT.PRG" PRG</div>
        <div class="terminal-line menu-item" onclick="loadProgram('projects')">20 "PROJECTS.PRG" PRG</div>
        <div class="terminal-line menu-item" onclick="loadProgram('writeups')">30 "WRITEUPS.PRG" PRG</div>
        <div class="terminal-line menu-item" onclick="loadProgram('links')">40 "LINKS.PRG" PRG</div>
      `;
      container.appendChild(menu);

      await addLine(container, '', 100);
      await addLine(container, '504 BLOCKS FREE.', 200);
      await addLine(container, '', 100);
      await addLine(container, 'READY.', 200);
      await addLine(container, '', 100);
      
      // Add helpful hint
      const hintLine = document.createElement('div');
      hintLine.className = 'terminal-line';
      hintLine.style.color = '#7C71DA';
      hintLine.innerHTML = 'TIP: JUST START TYPING!';
      container.appendChild(hintLine);
      await new Promise(resolve => setTimeout(resolve, 100));

      const cursorLine = document.createElement('div');
      cursorLine.className = 'terminal-line';
      cursorLine.id = 'cursorLine';
      cursorLine.innerHTML = '<span class="command-line" id="commandLine"></span><span class="cursor"></span>';
      container.appendChild(cursorLine);
    }

    async function loadAbout() {
      const content = document.getElementById('aboutContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR ABOUT.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      content.appendChild(loadLine);

      await new Promise(resolve => {
        let dots = '';
        let count = 0;
        const interval = setInterval(() => {
          dots += '.';
          loadLine.textContent = 'LOADING' + dots;
          count++;
          if (count >= 15) {
            clearInterval(interval);
            resolve();
          }
        }, 60);
      });

      await addLine(content, 'READY.', 100);
      await addLine(content, 'RUN', 100);
      await addLine(content, '', 100);
      await addLine(content, '================================', 50);
      await addLine(content, 'SARWAR "BARTMOSS"', 50);
      await addLine(content, '================================', 50);
      await addLine(content, '', 50);
      await addLine(content, 'SPECIALIZING IN:', 50);
      await addLine(content, '- ASSEMBLY PROGRAMMING', 50);
      await addLine(content, '- MALWARE DEVELOPMENT', 50);
      await addLine(content, '- OFFENSIVE SECURITY', 50);
      await addLine(content, '- REVERSE ENGINEERING', 50);
      await addLine(content, '', 100);
      await addLine(content, 'LANGUAGES: X64 ASM, C, PYTHON', 50);
      await addLine(content, 'PLATFORMS: WINDOWS, LINUX', 50);
      await addLine(content, '', 100);

      const techBox = document.createElement('div');
      techBox.style.cssText = 'border: 1px solid #7C71DA; padding: 15px; margin: 20px 0; background: transparent;';
      techBox.innerHTML = `
        <div class="terminal-line">TOOLS:</div>
        <div class="terminal-line"></div>
        <div class="terminal-line">ARCHITECTURE: X86-64</div>
        <div class="terminal-line">TOOLCHAIN: NASM</div>
        <div class="terminal-line">DEBUGGERS: X64DBG, GDB</div>
        <div class="terminal-line">DISASSEMBLERS: IDA</div>
        `
      content.appendChild(techBox);

      await addLine(content, '', 100);
      await addLine(content, 'READY.', 100);
    }

    async function loadProjects() {
      const content = document.getElementById('projectsContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR PROJECTS.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      content.appendChild(loadLine);

      await new Promise(resolve => {
        let dots = '';
        let count = 0;
        const interval = setInterval(() => {
          dots += '.';
          loadLine.textContent = 'LOADING' + dots;
          count++;
          if (count >= 15) {
            clearInterval(interval);
            resolve();
          }
        }, 60);
      });

      await addLine(content, 'READY.', 100);
      await addLine(content, 'RUN', 100);
      await addLine(content, '', 100);

      for (const project of projects) {
        const box = document.createElement('div');
        box.className = 'item-box';
        box.onclick = () => window.open(project.url, '_blank');
        box.innerHTML = `
          <div class="item-title">${project.title}</div>
          <div class="item-desc">${project.desc}</div>
        `;
        content.appendChild(box);
        await new Promise(resolve => setTimeout(resolve, 100));
      }

      await addLine(content, '', 100);
      await addLine(content, 'READY.', 100);
    }

    async function loadWriteups() {
      const content = document.getElementById('writeupsContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR WRITEUPS.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      content.appendChild(loadLine);

      await new Promise(resolve => {
        let dots = '';
        let count = 0;
        const interval = setInterval(() => {
          dots += '.';
          loadLine.textContent = 'LOADING' + dots;
          count++;
          if (count >= 15) {
            clearInterval(interval);
            resolve();
          }
        }, 60);
      });

      await addLine(content, 'READY.', 100);
      await addLine(content, 'RUN', 100);
      await addLine(content, '', 100);

      for (const writeup of writeups) {
        const box = document.createElement('div');
        box.className = 'item-box';
        box.onclick = () => window.open(writeup.url, '_blank');
        box.innerHTML = `
          <div class="item-title">${writeup.title}</div>
          <div class="item-desc">${writeup.desc}</div>
        `;
        content.appendChild(box);
        await new Promise(resolve => setTimeout(resolve, 100));
      }

      await addLine(content, '', 100);
      await addLine(content, 'READY.', 100);
    }

    async function loadLinks() {
      const content = document.getElementById('linksContent');
      content.innerHTML = '';

      // Show disk activity
      showDiskActivity(1500);

      await addLine(content, 'SEARCHING FOR LINKS.PRG', 100);
      const loadLine = document.createElement('div');
      loadLine.className = 'terminal-line';
      content.appendChild(loadLine);

      await new Promise(resolve => {
        let dots = '';
        let count = 0;
        const interval = setInterval(() => {
          dots += '.';
          loadLine.textContent = 'LOADING' + dots;
          count++;
          if (count >= 15) {
            clearInterval(interval);
            resolve();
          }
        }, 60);
      });

      await addLine(content, 'READY.', 100);
      await addLine(content, 'RUN', 100);
      await addLine(content, '', 100);
      await addLine(content, 'EXTERNAL RESOURCES:', 100);
      await addLine(content, '', 50);

      for (const link of links) {
        const box = document.createElement('div');
        box.className = 'link-box';
        box.onclick = () => window.open(link.url, '_blank');
        box.innerHTML = `
          ${link.title}
          <div class="item-desc" style="margin-top: 5px;">${link.desc}</div>
        `;
        content.appendChild(box);
        await new Promise(resolve => setTimeout(resolve, 80));
      }

      await addLine(content, '', 100);
      await addLine(content, 'READY.', 100);
    }

    function loadProgram(type) {
      const popup = document.getElementById('popup-' + type);
      popup.classList.add('active');

      if (type === 'about') loadAbout();
      else if (type === 'projects') loadProjects();
      else if (type === 'writeups') loadWriteups();
      else if (type === 'links') loadLinks();
    }

    function closePopup(type) {
      document.getElementById('popup-' + type).classList.remove('active');
    }

    // Konami Code Easter Egg
    let konamiCode = [];
    const konamiSequence = ['ArrowUp', 'ArrowUp', 'ArrowDown', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'ArrowLeft', 'ArrowRight', 'b', 'a'];
    
    function checkKonamiCode(key) {
      konamiCode.push(key);
      konamiCode.splice(-konamiSequence.length - 1, konamiCode.length - konamiSequence.length);
      
      if (konamiCode.join(',').includes(konamiSequence.join(','))) {
        const egg = document.getElementById('easterEgg');
        const border = document.getElementById('borderFlash');
        egg.classList.add('show');
        border.classList.add('active');
        setTimeout(() => border.classList.remove('active'), 500);
        showDiskActivity(500);
      }
    }

    // Command bar functionality
    let commandBarActive = false;
    let currentCommand = '';

    function toggleCommandBar() {
      // Not needed anymore - typing happens inline
    }

    function updateCommandDisplay() {
      const commandLine = document.getElementById('commandLine');
      if (commandLine) {
        commandLine.textContent = currentCommand;
        commandLine.classList.add('active');
      }
    }

    function executeCommand(cmd) {
      cmd = cmd.toUpperCase().trim();
      const border = document.getElementById('borderFlash');
      const container = document.getElementById('bootSequence');
      const commandLine = document.getElementById('commandLine');
      
      // Clear the command display
      currentCommand = '';
      if (commandLine) {
        commandLine.textContent = '';
        commandLine.classList.remove('active');
      }
      
      // Add command to screen
      const commandEcho = document.createElement('div');
      commandEcho.className = 'terminal-line';
      commandEcho.textContent = cmd;
      const cursorLine = document.getElementById('cursorLine');
      if (cursorLine && cursorLine.parentNode) {
        cursorLine.parentNode.insertBefore(commandEcho, cursorLine);
      }
      
      switch(cmd) {
        case 'HELP':
        case '?':
          const helpText = document.createElement('div');
          helpText.className = 'terminal-line';
          helpText.innerHTML = `AVAILABLE COMMANDS:<br><br>LIST - SHOW FILES<br>CLEAR/CLR - CLEAR SCREEN<br>SYS 64738 - RESET<br>LOAD - SHOW MENU<br>POKE - MEMORY DEMO<br>PEEK - MEMORY DEMO<br>F1-F4 - QUICK LOAD`;
          if (cursorLine && cursorLine.parentNode) {
            cursorLine.parentNode.insertBefore(helpText, cursorLine);
          }
          break;
        case 'LIST':
          window.scrollTo(0, 0);
          break;
        case 'CLEAR':
        case 'CLR':
          location.reload();
          break;
        case 'SYS 64738':
          border.classList.add('active');
          setTimeout(() => {
            border.classList.remove('active');
            location.reload();
          }, 500);
          break;
        case 'LOAD':
          window.scrollTo(0, 0);
          break;
        case 'POKE':
          showDiskActivity(300);
          const pokeMsg = document.createElement('div');
          pokeMsg.className = 'terminal-line';
          pokeMsg.textContent = 'POKE 53280,0';
          if (cursorLine && cursorLine.parentNode) {
            cursorLine.parentNode.insertBefore(pokeMsg, cursorLine);
          }
          break;
        case 'PEEK':
          const peekMsg = document.createElement('div');
          peekMsg.className = 'terminal-line';
          peekMsg.textContent = 'PEEK(53280) = 6';
          if (cursorLine && cursorLine.parentNode) {
            cursorLine.parentNode.insertBefore(peekMsg, cursorLine);
          }
          break;
        default:
          if (cmd) {
            const errorMsg = document.createElement('div');
            errorMsg.className = 'terminal-line';
            errorMsg.textContent = '?SYNTAX ERROR';
            if (cursorLine && cursorLine.parentNode) {
              cursorLine.parentNode.insertBefore(errorMsg, cursorLine);
            }
          }
      }
      
      // Scroll to bottom
      window.scrollTo(0, document.body.scrollHeight);
    }

    document.querySelectorAll('.popup-overlay').forEach(overlay => {
      overlay.addEventListener('click', function (e) {
        if (e.target === this) {
          this.classList.remove('active');
        }
      });
    });

    document.addEventListener('keydown', function (e) {
      // Easter egg detection
      checkKonamiCode(e.key);

      // Close easter egg
      if (e.key === 'Escape') {
        const egg = document.getElementById('easterEgg');
        egg.classList.remove('show');
        
        document.querySelectorAll('.popup-overlay').forEach(overlay => {
          overlay.classList.remove('active');
        });
      }

      // Prevent typing when popups are open
      const anyPopupOpen = Array.from(document.querySelectorAll('.popup-overlay')).some(el => el.classList.contains('active'));
      if (anyPopupOpen && e.key !== 'Escape' && !e.key.startsWith('F')) {
        return;
      }

      // F1-F4 Quick Load
      if (e.key === 'F1') {
        e.preventDefault();
        loadProgram('about');
      } else if (e.key === 'F2') {
        e.preventDefault();
        loadProgram('projects');
      } else if (e.key === 'F3') {
        e.preventDefault();
        loadProgram('writeups');
      } else if (e.key === 'F4') {
        e.preventDefault();
        loadProgram('links');
      }

      // Handle typing
      if (e.key === 'Enter') {
        executeCommand(currentCommand);
      } else if (e.key === 'Backspace') {
        e.preventDefault();
        currentCommand = currentCommand.slice(0, -1);
        updateCommandDisplay();
      } else if (e.key.length === 1 && !e.ctrlKey && !e.metaKey && !e.altKey) {
        // Only printable characters
        currentCommand += e.key.toUpperCase();
        updateCommandDisplay();
      }
    });

    // Remove old command bar toggle
    document.querySelector('.credits').addEventListener('click', () => {
      // Click on credits shows help
      const helpText = 'C64 TERMINAL COMMANDS:\n\nHELP - Show commands\nLIST - Show menu\nCLEAR - Reload\nSYS 64738 - Reset\nF1-F4 - Quick load\n\nJust start typing!';
      alert(helpText);
    });

    window.addEventListener('load', bootSequence);
  </script>
</body>

</html>